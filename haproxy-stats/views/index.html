<!DOCTYPE html>
<html>
<head>
<title></title>
<link rel='stylesheet' href='/stylesheets/style.css' />
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<!--script src="http://code.highcharts.com/highcharts.js"></script-->
<script src="http://code.highcharts.com/stock/highstock.js"></script>
<script src="http://code.highcharts.com/stock/modules/exporting.js"></script>
<script>
	function ChartClicked(oPointObject) {            
           		 if (oPointObject.selected) {
                		oPointObject.select(false, true);                
            		}
            		else {
                		oPointObject.select(true, true);                
            		}            
         	}
  		var timer;
	function chart(box,svname) {
		if(box == '' || svname == ''){
			return;
		}
		var url = 'http://localhost:8080/rest/load/?pxname=healthkart&box='+box+'&svname='+svname;
		var url2 = 'http://localhost:8080/rest/live/?pxname=healthkart&box='+box+'&svname='+svname;
		$.getJSON(url, function(data) {
			// Create the chart
				Highcharts.setOptions({
        			global: {
        				useUTC : false,
            			}
    			});
				$('#container').highcharts('StockChart', {
				chart: {
					type : 'spline',
					events : {
						load : function() {
							var series = this.series[0];
							setInterval(function() {
								$.getJSON(url2, function(values) {
									var x = values['timestamp'];
									var y = values['rate'];
									series.addPoint([x, y],true,true);
								});	
							}, 10000);
						}
					}
				},
				credits: {
					href: "Created by Vikas Aggarwal",
				},
				plotOptions: {						            
					series: {
                		color: 'Green',
                		connectNulls: true,
						cursor: 'pointer',
                		point: {
                    		events: {
                        		click: function () {
                            		alert("Time: " + new Date(this.x) + "Session Rate: " + this.y);
                        		}
                    		}
                		}		
            		}
        		},
				crosshairs: {
	    			dashStyle: 'dash'
	    		},	
				xAxis: {
            		type: 'datetime',
            		range: 3600 * 100,
            			
					title : {
						text : 'Time line'
					},
					labels: {
        				formatter: function() {
             				return Highcharts.dateFormat("%H:%M", this.value);
        				}
    				}
        		},
        		yAxis : {
        			opposite : false,
        			title : {
        				text : 'Session Rate'
        			},
					plotBands : [{
						from : 0,
						to : 30,
						color : 'rgba(68, 170, 213, 0.2)',
						label : {
							text : 'Safe Zone'
						}
					}]
        		},
				title : {
					text : 'Haproxy - Stats'
				},
				legend: {
	    			enabled: true,			
	    		},
				series : [data]
			});
		});
			//timer = setTimeout(function(){
			//	chart(box,svname);
			//},7000);
	}
	function stop(){
		alert('Terminating Autoload');
			//clearTimeout(timer);
			//$('#container').highcharts().destroy();
	}			
	</script>
</head>
<body>
	<button onClick="stop();">Stop Reload</button>
	<select id="prod" onChange=stop();chart('prod',this.value);>
		<option value="">Production Boxes</option>
		<option value="vmn-265-P">VMN-265-P</option>
		<option value="vmn-400-Q">VMN-400-Q</option>
		<option value="vmn-396-R">VMN-396-R</option>
		<option value="vmn-339-S">VMN-339-S</option>
		<option>------------------</option>
	</select>

	<select id="api" onChange=stop();chart('api',this.value);>
		<option value="">API Boxes</option>
		<option value="spkd-0210">SPKD-0210</option>
		<option value="spkd-0211">SPKD-0211</option>
		<option value="vmn-416">VMN-416</option>
		<option>------------------</option>
	</select>



	<!--button onClick="chart('http://localhost:8082/rest/api/?pxname=healthkart&box=prod&svname=vmn-265-P');">VMN-265-P</button-->
	<div id="container" style="width: 100%; height: 400px;"></div>
</body>
</html>
